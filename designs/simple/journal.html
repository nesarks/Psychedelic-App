<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mindful Journey | Journal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="css/custom.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#f5f3ff',
                            100: '#ede9fe',
                            200: '#ddd6fe',
                            300: '#c4b5fd',
                            400: '#a78bfa',
                            500: '#8b5cf6',
                            600: '#7c3aed',
                            700: '#6d28d9',
                            800: '#5b21b6',
                            900: '#4c1d95',
                        },
                        secondary: {
                            50: '#ecfdf5',
                            100: '#d1fae5',
                            200: '#a7f3d0',
                            300: '#6ee7b7',
                            400: '#34d399',
                            500: '#10b981',
                            600: '#059669',
                            700: '#047857',
                            800: '#065f46',
                            900: '#064e3b',
                        },
                        neutral: {
                            50: '#fafafa',
                            100: '#f5f5f5',
                            200: '#e5e5e5',
                            300: '#d4d4d4',
                            400: '#a3a3a3',
                            500: '#737373',
                            600: '#525252',
                            700: '#404040',
                            800: '#262626',
                            900: '#171717',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gradient-to-br from-primary-50 to-secondary-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header with back button -->
        <header class="flex items-center mb-8">
            <a href="index.html" class="mr-4 text-neutral-600 hover:text-primary-600 transition-colors duration-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                </svg>
            </a>
            <h1 class="text-2xl font-light text-primary-700">Journal & Reflection</h1>
        </header>

        <!-- Main Content -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Left Column: Journal Entry Form -->
            <div class="md:col-span-2">
                <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl text-primary-700">New Entry</h2>
                        <div>
                            <select id="entryType" class="p-2 text-sm border border-neutral-200 rounded-lg focus:ring-2 focus:ring-primary-300 focus:border-primary-500 outline-none">
                                <option value="reflection">Post-Trip Reflection</option>
                                <option value="intention">Pre-Trip Intention</option>
                                <option value="microdose">Microdose Journal</option>
                                <option value="general">General Note</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="mb-4">
                        <label for="journalTitle" class="block text-neutral-700 mb-1">Title</label>
                        <input type="text" id="journalTitle" class="w-full p-3 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary-300 focus:border-primary-500 outline-none" placeholder="Give your entry a title...">
                    </div>
                    
                    <div class="mb-4">
                        <label for="journalContent" class="block text-neutral-700 mb-1">Your Thoughts</label>
                        <textarea id="journalContent" rows="12" class="w-full p-3 border border-neutral-300 rounded-lg focus:ring-2 focus:ring-primary-300 focus:border-primary-500 outline-none" placeholder="Begin writing your reflection..."></textarea>
                    </div>

                    <div class="flex justify-between items-center mb-4">
                        <div class="flex items-center">
                            <input type="checkbox" id="privateEntry" class="mr-2">
                            <label for="privateEntry" class="text-neutral-600 text-sm">Store locally only</label>
                        </div>
                        <button id="aiSuggest" class="px-4 py-2 bg-primary-100 text-primary-700 rounded-lg hover:bg-primary-200 transition-colors duration-200 flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                            </svg>
                            <span>Get Reflection Prompts</span>
                        </button>
                    </div>
                    
                    <div id="promptSuggestions" class="mb-4 bg-primary-50 p-4 rounded-lg hidden">
                        <h3 class="text-primary-800 mb-2 font-medium">Reflection Prompts</h3>
                        <ul class="space-y-2">
                            <li class="flex items-start">
                                <span class="text-primary-500 mr-2">•</span>
                                <button class="prompt-btn text-left hover:text-primary-700 transition-colors duration-200">What insights about yourself did you gain from this experience?</button>
                            </li>
                            <li class="flex items-start">
                                <span class="text-primary-500 mr-2">•</span>
                                <button class="prompt-btn text-left hover:text-primary-700 transition-colors duration-200">How did this experience compare to your initial intentions?</button>
                            </li>
                            <li class="flex items-start">
                                <span class="text-primary-500 mr-2">•</span>
                                <button class="prompt-btn text-left hover:text-primary-700 transition-colors duration-200">What emotions came up that surprised you?</button>
                            </li>
                            <li class="flex items-start">
                                <span class="text-primary-500 mr-2">•</span>
                                <button class="prompt-btn text-left hover:text-primary-700 transition-colors duration-200">What aspects of the experience would you like to integrate into your daily life?</button>
                            </li>
                            <li class="flex items-start">
                                <span class="text-primary-500 mr-2">•</span>
                                <button class="prompt-btn text-left hover:text-primary-700 transition-colors duration-200">If you could tell your pre-journey self one thing, what would it be?</button>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="flex justify-end">
                        <button id="saveJournal" class="px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors duration-200">Save Entry</button>
                    </div>
                </div>
                
                <!-- Integration Tips -->
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <h2 class="text-xl text-primary-700 mb-4">Integration Tips</h2>
                    <div class="text-neutral-600">
                        <p class="mb-3">Integration is the process of incorporating insights from your psychedelic experience into your daily life.</p>
                        <ul class="space-y-3 mb-3">
                            <li class="flex items-start">
                                <span class="text-primary-500 mr-2">•</span>
                                <span>Give yourself time to process - insights may continue to unfold days or weeks later</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-primary-500 mr-2">•</span>
                                <span>Consider starting a daily meditation practice to strengthen awareness</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-primary-500 mr-2">•</span>
                                <span>Create art, music, or writing inspired by your experience</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-primary-500 mr-2">•</span>
                                <span>Connect with community through integration circles (online or in-person)</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-primary-500 mr-2">•</span>
                                <span>Be patient with yourself - integration is an ongoing process</span>
                            </li>
                        </ul>
                        <p>Remember that even challenging experiences can offer profound opportunities for growth when approached with curiosity and compassion.</p>
                    </div>
                </div>
            </div>
            
            <!-- Right Column: Journal Entries List -->
            <div>
                <div class="bg-white rounded-xl shadow-sm p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl text-primary-700">Your Entries</h2>
                        <select id="entriesFilter" class="p-2 text-sm border border-neutral-200 rounded-lg focus:ring-2 focus:ring-primary-300 focus:border-primary-500 outline-none">
                            <option value="all">All Entries</option>
                            <option value="reflection">Reflections</option>
                            <option value="intention">Intentions</option>
                            <option value="microdose">Microdose</option>
                            <option value="general">General</option>
                        </select>
                    </div>
                    
                    <div id="entriesList" class="space-y-3 max-h-[600px] overflow-y-auto pr-2">
                        <!-- Empty state -->
                        <div id="emptyState" class="text-center py-8">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-neutral-300 mx-auto mb-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" />
                            </svg>
                            <p class="text-neutral-500">No journal entries yet</p>
                            <p class="text-neutral-400 text-sm">Your entries will appear here</p>
                        </div>
                        
                        <!-- Example entries (will be populated by JS) -->
                        <div class="entry-item p-4 border border-neutral-200 rounded-lg hover:border-primary-300 transition-colors duration-200 cursor-pointer">
                            <div class="flex justify-between items-start mb-1">
                                <h3 class="font-medium text-neutral-800">First Mushroom Journey</h3>
                                <span class="text-xs text-neutral-500">Jul 15, 2025</span>
                            </div>
                            <div class="flex items-center mb-2">
                                <span class="text-xs bg-primary-100 text-primary-800 rounded-full px-2 py-0.5">Reflection</span>
                            </div>
                            <p class="text-neutral-600 text-sm line-clamp-2">Today I experienced my first psilocybin journey. The visuals were breathtaking, and I felt a deep connection to nature...</p>
                        </div>
                        
                        <div class="entry-item p-4 border border-neutral-200 rounded-lg hover:border-primary-300 transition-colors duration-200 cursor-pointer">
                            <div class="flex justify-between items-start mb-1">
                                <h3 class="font-medium text-neutral-800">Healing Intention</h3>
                                <span class="text-xs text-neutral-500">Jul 10, 2025</span>
                            </div>
                            <div class="flex items-center mb-2">
                                <span class="text-xs bg-secondary-100 text-secondary-800 rounded-full px-2 py-0.5">Intention</span>
                            </div>
                            <p class="text-neutral-600 text-sm line-clamp-2">I'm setting an intention to explore childhood memories and heal past wounds. I want to approach this with openness...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- View Entry Modal -->
    <div id="viewEntryModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-xl shadow-lg p-6 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <div>
                    <h2 id="modalEntryTitle" class="text-xl font-medium text-neutral-800">Entry Title</h2>
                    <div class="flex items-center mt-1">
                        <span id="modalEntryType" class="text-xs bg-primary-100 text-primary-800 rounded-full px-2 py-0.5 mr-2">Reflection</span>
                        <span id="modalEntryDate" class="text-sm text-neutral-500">Jul 15, 2025</span>
                    </div>
                </div>
                <button id="closeViewModal" class="text-neutral-500 hover:text-neutral-700">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <div class="mb-6">
                <div id="modalEntryContent" class="text-neutral-700 whitespace-pre-wrap">
                    Entry content will be displayed here.
                </div>
            </div>
            
            <div class="flex justify-between items-center border-t border-neutral-200 pt-4">
                <button id="deleteEntry" class="px-4 py-2 text-red-600 hover:text-red-700 transition-colors duration-200">
                    Delete Entry
                </button>
                <div>
                    <button id="editEntry" class="px-4 py-2 bg-primary-100 text-primary-700 rounded-lg hover:bg-primary-200 transition-colors duration-200 mr-2">
                        Edit
                    </button>
                    <button id="closeEntry" class="px-4 py-2 bg-neutral-100 text-neutral-700 rounded-lg hover:bg-neutral-200 transition-colors duration-200">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/journal.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Sample data (in a real app, this would come from your Flask backend)
            let journalEntries = [
                {
                    id: 1,
                    title: "First Mushroom Journey",
                    content: "Today I experienced my first psilocybin journey. The visuals were breathtaking, and I felt a deep connection to nature. During the peak, I had a profound realization about my relationship with my parents and how much their love has shaped me.\n\nI felt emotions I hadn't accessed in years, both joy and some sadness about past regrets. But overall, there was a sense of acceptance and peace that I want to carry forward.\n\nKey insights:\n- Nature connection feels vital to my wellbeing\n- I need to express gratitude to my parents more often\n- My anxiety seems connected to fear of disappointing others",
                    type: "reflection",
                    date: "2025-07-15",
                    private: false
                },
                {
                    id: 2,
                    title: "Healing Intention",
                    content: "I'm setting an intention to explore childhood memories and heal past wounds. I want to approach this with openness and self-compassion, knowing that whatever arises is part of my healing journey.\n\nSpecific intentions:\n1. Understand the root of my fear of abandonment\n2. Connect with my authentic self without judgment\n3. Release patterns that no longer serve me",
                    type: "intention",
                    date: "2025-07-10",
                    private: true
                }
            ];
            
            // Load journal entries from localStorage if available
            const storedEntries = localStorage.getItem('journalEntries');
            if (storedEntries) {
                journalEntries = JSON.parse(storedEntries);
            }
            
            // Also check for any insights captured during trip mode
            const tripInsights = JSON.parse(localStorage.getItem('insights') || '[]');
            if (tripInsights.length > 0) {
                tripInsights.forEach(insight => {
                    const date = new Date(insight.timestamp);
                    journalEntries.push({
                        id: Date.now() + Math.floor(Math.random() * 1000),
                        title: "Trip Insight",
                        content: insight.text,
                        type: "reflection",
                        date: date.toISOString().split('T')[0],
                        private: false
                    });
                });
                // Clear the trip insights after importing
                localStorage.removeItem('insights');
                // Save the updated journal entries
                localStorage.setItem('journalEntries', JSON.stringify(journalEntries));
            }
            
            // Display journal entries
            function displayEntries(filter = 'all') {
                const entriesList = document.getElementById('entriesList');
                const emptyState = document.getElementById('emptyState');
                
                // Filter entries if needed
                let filteredEntries = journalEntries;
                if (filter !== 'all') {
                    filteredEntries = journalEntries.filter(entry => entry.type === filter);
                }
                
                // Sort entries by date (newest first)
                filteredEntries.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                // Show empty state if no entries
                if (filteredEntries.length === 0) {
                    emptyState.classList.remove('hidden');
                    entriesList.innerHTML = '';
                    entriesList.appendChild(emptyState);
                    return;
                }
                
                // Hide empty state and display entries
                emptyState.classList.add('hidden');
                entriesList.innerHTML = '';
                
                filteredEntries.forEach(entry => {
                    const entryElement = document.createElement('div');
                    entryElement.className = 'entry-item p-4 border border-neutral-200 rounded-lg hover:border-primary-300 transition-colors duration-200 cursor-pointer';
                    entryElement.dataset.id = entry.id;
                    
                    // Format date for display
                    const date = new Date(entry.date);
                    const formattedDate = date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
                    
                    // Determine tag color based on entry type
                    let tagClass = '';
                    switch(entry.type) {
                        case 'reflection':
                            tagClass = 'bg-primary-100 text-primary-800';
                            break;
                        case 'intention':
                            tagClass = 'bg-secondary-100 text-secondary-800';
                            break;
                        case 'microdose':
                            tagClass = 'bg-yellow-100 text-yellow-800';
                            break;
                        default:
                            tagClass = 'bg-neutral-100 text-neutral-800';
                    }
                    
                    // Capitalize entry type for display
                    const displayType = entry.type.charAt(0).toUpperCase() + entry.type.slice(1);
                    
                    entryElement.innerHTML = `
                        <div class="flex justify-between items-start mb-1">
                            <h3 class="font-medium text-neutral-800">${entry.title}</h3>
                            <span class="text-xs text-neutral-500">${formattedDate}</span>
                        </div>
                        <div class="flex items-center mb-2">
                            <span class="text-xs ${tagClass} rounded-full px-2 py-0.5">${displayType}</span>
                            ${entry.private ? '<span class="text-xs ml-2 bg-red-100 text-red-800 rounded-full px-2 py-0.5">Private</span>' : ''}
                        </div>
                        <p class="text-neutral-600 text-sm line-clamp-2">${entry.content}</p>
                    `;
                    
                    // Add click event to view entry
                    entryElement.addEventListener('click', () => {
                        viewEntry(entry.id);
                    });
                    
                    entriesList.appendChild(entryElement);
                });
            }
            
            // View entry details
            function viewEntry(id) {
                const entry = journalEntries.find(e => e.id == id);
                if (!entry) return;
                
                document.getElementById('modalEntryTitle').textContent = entry.title;
                document.getElementById('modalEntryContent').textContent = entry.content;
                
                // Format date
                const date = new Date(entry.date);
                document.getElementById('modalEntryDate').textContent = date.toLocaleDateString('en-US', { 
                    weekday: 'long', 
                    month: 'long', 
                    day: 'numeric', 
                    year: 'numeric' 
                });
                
                // Set entry type
                const entryTypeEl = document.getElementById('modalEntryType');
                const displayType = entry.type.charAt(0).toUpperCase() + entry.type.slice(1);
                entryTypeEl.textContent = displayType;
                
                // Set tag color
                entryTypeEl.className = 'text-xs rounded-full px-2 py-0.5 mr-2';
                switch(entry.type) {
                    case 'reflection':
                        entryTypeEl.classList.add('bg-primary-100', 'text-primary-800');
                        break;
                    case 'intention':
                        entryTypeEl.classList.add('bg-secondary-100', 'text-secondary-800');
                        break;
                    case 'microdose':
                        entryTypeEl.classList.add('bg-yellow-100', 'text-yellow-800');
                        break;
                    default:
                        entryTypeEl.classList.add('bg-neutral-100', 'text-neutral-800');
                }
                
                // Store the current entry ID for edit/delete operations
                document.getElementById('viewEntryModal').dataset.entryId = id;
                
                // Show the modal
                document.getElementById('viewEntryModal').classList.remove('hidden');
            }
            
            // Save journal entry
            document.getElementById('saveJournal').addEventListener('click', function() {
                const title = document.getElementById('journalTitle').value.trim();
                const content = document.getElementById('journalContent').value.trim();
                const type = document.getElementById('entryType').value;
                const isPrivate = document.getElementById('privateEntry').checked;
                
                if (!title || !content) {
                    alert('Please enter a title and content for your journal entry.');
                    return;
                }
                
                const newEntry = {
                    id: Date.now(),
                    title,
                    content,
                    type,
                    date: new Date().toISOString().split('T')[0],
                    private: isPrivate
                };
                
                journalEntries.push(newEntry);
                
                // Save to localStorage
                localStorage.setItem('journalEntries', JSON.stringify(journalEntries));
                
                // In a real app, you would also save to your Flask backend if not private
                // if (!isPrivate) {
                //     fetch('/api/journal', {
                //         method: 'POST',
                //         headers: {
                //             'Content-Type': 'application/json',
                //         },
                //         body: JSON.stringify(newEntry),
                //     });
                // }
                
                // Clear form
                document.getElementById('journalTitle').value = '';
                document.getElementById('journalContent').value = '';
                
                // Update entries display
                displayEntries(document.getElementById('entriesFilter').value);
                
                // Show confirmation
                alert('Journal entry saved successfully!');
            });
            
            // Filter entries
            document.getElementById('entriesFilter').addEventListener('change', function() {
                displayEntries(this.value);
            });
            
            // Close entry view modal
            document.getElementById('closeViewModal').addEventListener('click', function() {
                document.getElementById('viewEntryModal').classList.add('hidden');
            });
            
            document.getElementById('closeEntry').addEventListener('click', function() {
                document.getElementById('viewEntryModal').classList.add('hidden');
            });
            
            // Delete entry
            document.getElementById('deleteEntry').addEventListener('click', function() {
                if (confirm('Are you sure you want to delete this entry? This cannot be undone.')) {
                    const entryId = document.getElementById('viewEntryModal').dataset.entryId;
                    journalEntries = journalEntries.filter(entry => entry.id != entryId);
                    
                    // Update localStorage
                    localStorage.setItem('journalEntries', JSON.stringify(journalEntries));
                    
                    // Close modal and update display
                    document.getElementById('viewEntryModal').classList.add('hidden');
                    displayEntries(document.getElementById('entriesFilter').value);
                }
            });
            
            // Edit entry
            document.getElementById('editEntry').addEventListener('click', function() {
                const entryId = document.getElementById('viewEntryModal').dataset.entryId;
                const entry = journalEntries.find(e => e.id == entryId);
                
                if (entry) {
                    // Fill form with entry data
                    document.getElementById('journalTitle').value = entry.title;
                    document.getElementById('journalContent').value = entry.content;
                    document.getElementById('entryType').value = entry.type;
                    document.getElementById('privateEntry').checked = entry.private;
                    
                    // Close modal
                    document.getElementById('viewEntryModal').classList.add('hidden');
                    
                    // Delete the original entry
                    journalEntries = journalEntries.filter(e => e.id != entryId);
                    localStorage.setItem('journalEntries', JSON.stringify(journalEntries));
                    
                    // Scroll to form
                    document.getElementById('journalTitle').scrollIntoView({ behavior: 'smooth' });
                    document.getElementById('journalTitle').focus();
                }
            });
            
            // Toggle AI suggestions
            document.getElementById('aiSuggest').addEventListener('click', function() {
                const suggestionsPanel = document.getElementById('promptSuggestions');
                suggestionsPanel.classList.toggle('hidden');
                
                // Change button text
                if (suggestionsPanel.classList.contains('hidden')) {
                    this.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                        <span>Get Reflection Prompts</span>
                    `;
                } else {
                    this.innerHTML = `
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                        </svg>
                        <span>Hide Prompts</span>
                    `;
                }
            });
            
            // Use prompt in journal
            document.querySelectorAll('.prompt-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const prompt = this.textContent;
                    const textarea = document.getElementById('journalContent');
                    
                    // Add prompt to textarea, with a newline if there's already content
                    if (textarea.value) {
                        textarea.value += '\n\n' + prompt + '\n';
                    } else {
                        textarea.value = prompt + '\n';
                    }
                    
                    // Focus textarea and scroll to end
                    textarea.focus();
                    textarea.scrollTop = textarea.scrollHeight;
                });
            });
            
            // Dynamic prompt loading based on entry type
            document.getElementById('entryType').addEventListener('change', function() {
                const promptType = this.value;
                const promptsContainer = document.getElementById('promptSuggestions').querySelector('ul');
                
                // Different prompts based on entry type
                let prompts = [];
                
                switch(promptType) {
                    case 'reflection':
                        prompts = [
                            "What insights about yourself did you gain from this experience?",
                            "How did this experience compare to your initial intentions?",
                            "What emotions came up that surprised you?",
                            "What aspects of the experience would you like to integrate into your daily life?",
                            "If you could tell your pre-journey self one thing, what would it be?"
                        ];
                        break;
                    case 'intention':
                        prompts = [
                            "What are you hoping to learn or discover through this experience?",
                            "What patterns or behaviors would you like to examine?",
                            "How might this experience contribute to your personal growth?",
                            "What emotional or psychological barriers are you hoping to address?",
                            "What would a positive outcome from this journey look like for you?"
                        ];
                        break;
                    case 'microdose':
                        prompts = [
                            "How did today's microdose affect your mood and energy levels?",
                            "Did you notice any changes in your creativity or problem-solving abilities?",
                            "How was your social connectivity and empathy today?",
                            "Did you experience any physical sensations worth noting?",
                            "What tasks or activities felt different while microdosing?"
                        ];
                        break;
                    default:
                        prompts = [
                            "What's on your mind today?",
                            "What emotions are you experiencing right now?",
                            "What insights or realizations have you had recently?",
                            "How is your relationship with yourself evolving?",
                            "What are you grateful for at this moment?"
                        ];
                }
                
                // Update the prompts in the UI
                promptsContainer.innerHTML = '';
                prompts.forEach(prompt => {
                    const li = document.createElement('li');
                    li.className = 'flex items-start';
                    li.innerHTML = `
                        <span class="text-primary-500 mr-2">•</span>
                        <button class="prompt-btn text-left hover:text-primary-700 transition-colors duration-200">${prompt}</button>
                    `;
                    promptsContainer.appendChild(li);
                });
                
                // Re-attach event listeners to new prompt buttons
                document.querySelectorAll('.prompt-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const prompt = this.textContent;
                        const textarea = document.getElementById('journalContent');
                        
                        if (textarea.value) {
                            textarea.value += '\n\n' + prompt + '\n';
                        } else {
                            textarea.value = prompt + '\n';
                        }
                        
                        textarea.focus();
                        textarea.scrollTop = textarea.scrollHeight;
                    });
                });
            });
            
            // Initialize entries display
            displayEntries();
            
            // Set current date
            const today = new Date();
            document.getElementById('journalTitle').placeholder = `Entry for ${today.toLocaleDateString('en-US', { 
                month: 'long', 
                day: 'numeric', 
                year: 'numeric' 
            })}`;
            
            // Check for entry from trip mode to pre-populate
            const currentTripData = JSON.parse(localStorage.getItem('tripPreparation') || '{}');
            if (currentTripData.intention && currentTripData.intention.details) {
                // Pre-populate with intention from trip prep
                if (document.getElementById('journalContent').value === '') {
                    document.getElementById('journalContent').value = `My intention for this journey was:\n\n"${currentTripData.intention.details}"\n\nReflections on the experience:\n`;
                }
            }
            
            // Add current user and timestamp metadata
            const currentUser = 'nesarks'; // In a real app, this would come from your authentication system
            const currentTimestamp = '2025-07-22 06:20:59'; // This would normally be generated on the server
            
            // Add this metadata to new entries
            document.getElementById('saveJournal').addEventListener('click', function() {
                // Add metadata if not already added
                if (!this.dataset.metadataAdded) {
                    const textarea = document.getElementById('journalContent');
                    textarea.value += `\n\n---\nJournal entry by: ${currentUser}\nCreated: ${currentTimestamp}`;
                    this.dataset.metadataAdded = 'true';
                }
            });
        });
    </script>
</body>
</html>